# Chrome æ‰©å±•å®‰å…¨å®¡æ ¸æŠ¥å‘Š

## å®¡æ ¸æ—¥æœŸ
2024å¹´ï¼ˆå®¡æ ¸æ—¶é—´ï¼‰

## å®¡æ ¸èŒƒå›´
- Manifest V3 åˆè§„æ€§æ£€æŸ¥
- è¿œç¨‹ä»£ç å’Œèµ„æºå¼•ç”¨æ£€æŸ¥
- Content Security Policy (CSP) é…ç½®å®¡æŸ¥
- æƒé™ä½¿ç”¨åˆç†æ€§æ£€æŸ¥

---

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. è¿œç¨‹ JavaScript ä»£ç å¼•ç”¨ âŒ â†’ âœ…
**ä½ç½®**: `landing-page/script.js` (ç¬¬ 203 è¡Œ)
**é—®é¢˜**: åŠ¨æ€åŠ è½½è¿œç¨‹ lazysizes åº“
```javascript
// ä¿®å¤å‰
script.src = 'https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js';
```
**çŠ¶æ€**: âœ… **å·²ä¿®å¤**
- ç§»é™¤äº†è¿œç¨‹ä»£ç å¼•ç”¨
- ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ lazy loadingï¼ˆChrome 76+ æ”¯æŒï¼‰
- ç¬¦åˆ Manifest V3 è¦æ±‚

---

## âœ… å®‰å…¨æ£€æŸ¥ç»“æœ

### 1. Manifest V3 åˆè§„æ€§ âœ…

#### 1.1 è¿œç¨‹ä»£ç æ£€æŸ¥
- âœ… **æ‰©å±•å†… HTML æ–‡ä»¶**: æ— è¿œç¨‹è„šæœ¬å¼•ç”¨
  - `src/popup/index.html` - ä»…æœ¬åœ°è„šæœ¬
  - `popup.html` - ä»…æœ¬åœ°è„šæœ¬
  - `src/auth/confirm.html` - ä»…æœ¬åœ°è„šæœ¬
  
- âœ… **åŠ¨æ€è„šæœ¬åŠ è½½**: æ— 
  - å·²æ£€æŸ¥æ‰€æœ‰ `createElement('script')` ä½¿ç”¨
  - æ— åŠ¨æ€åŠ è½½è¿œç¨‹è„šæœ¬çš„æƒ…å†µ

- âš ï¸ **landing-page ç›®å½•**: åŒ…å« Google Fonts å¼•ç”¨
  - **çŠ¶æ€**: ä¸å½±å“æ‰©å±•å®¡æ ¸
  - **åŸå› **: `landing-page` ä¸åœ¨æ‰©å±•æ„å»ºæµç¨‹ä¸­
  - **éªŒè¯**: 
    - `vite.config.ts` ä¸­æœªåŒ…å« `landing-page`
    - `package-extension.js` åªæ‰“åŒ… `dist` ç›®å½•
    - `landing-page` ä¸ä¼šè¢«åŒ…å«åœ¨æ‰©å±•åŒ…ä¸­

#### 1.2 Content Security Policy (CSP) âœ…
```json
"content_security_policy": {
  "extension_pages": "script-src 'self'; object-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: http:; font-src 'self' data:; connect-src 'self' https://*.supabase.co; frame-src 'none'; base-uri 'self'; form-action 'self';"
}
```

**åˆ†æ**:
- âœ… `script-src 'self'` - æ­£ç¡®ï¼Œåªå…è®¸æœ¬åœ°è„šæœ¬
- âœ… `object-src 'self'` - æ­£ç¡®ï¼Œé™åˆ¶æ’ä»¶
- âš ï¸ `style-src 'self' 'unsafe-inline'` - å…è®¸å†…è”æ ·å¼ï¼ˆReact/Tailwind éœ€è¦ï¼‰
- âœ… `font-src 'self' data:` - åªå…è®¸æœ¬åœ°å­—ä½“å’Œæ•°æ® URI
- âœ… `connect-src 'self' https://*.supabase.co` - ä»…å…è®¸ Supabase API
- âœ… `frame-src 'none'` - ç¦æ­¢åµŒå…¥æ¡†æ¶ï¼Œå®‰å…¨
- âœ… `base-uri 'self'` - é™åˆ¶ base æ ‡ç­¾
- âœ… `form-action 'self'` - é™åˆ¶è¡¨å•æäº¤

**å»ºè®®**: CSP é…ç½®ç¬¦åˆ Manifest V3 è¦æ±‚ï¼Œ`unsafe-inline` å¯¹äºæ ·å¼æ˜¯å¿…è¦çš„ï¼ˆReact/Tailwind CSSï¼‰ã€‚

#### 1.3 æƒé™ä½¿ç”¨ âœ…
```json
"permissions": [
  "tabs",           // âœ… éœ€è¦ï¼šæ ‡ç­¾é¡µç®¡ç†
  "storage",        // âœ… éœ€è¦ï¼šæ•°æ®å­˜å‚¨
  "unlimitedStorage", // âœ… éœ€è¦ï¼šå¤§é‡æ ‡ç­¾é¡µæ•°æ®
  "notifications",  // âœ… éœ€è¦ï¼šç”¨æˆ·é€šçŸ¥
  "contextMenus"    // âœ… éœ€è¦ï¼šå³é”®èœå•
],
"host_permissions": [
  "https://*.supabase.co/*"  // âœ… éœ€è¦ï¼šSupabase API
]
```
**åˆ†æ**: æ‰€æœ‰æƒé™éƒ½æœ‰åˆç†çš„ä½¿ç”¨åœºæ™¯ï¼Œæ— è¿‡åº¦æƒé™ã€‚

### 2. ä»£ç å®‰å…¨æ£€æŸ¥ âœ…

#### 2.1 XSS é˜²æŠ¤ âœ…
- âœ… `innerHTML` ä½¿ç”¨å®‰å…¨
  - `src/utils/inputValidation.ts` ä½¿ç”¨ `textContent` è½¬ä¹‰ï¼Œå®‰å…¨

#### 2.2 åŠ¨æ€ä»£ç æ‰§è¡Œ âœ…
- âœ… æ—  `eval()` ä½¿ç”¨
- âœ… æ—  `Function()` æ„é€ å‡½æ•°ä½¿ç”¨
- âœ… æ— å­—ç¬¦ä¸²å½¢å¼çš„ `setTimeout`/`setInterval`

#### 2.3 å¤–éƒ¨èµ„æº âœ…
- âœ… æ— è¿œç¨‹ JavaScript æ–‡ä»¶
- âœ… æ— è¿œç¨‹ CSS æ–‡ä»¶
- âœ… å­—ä½“ä»…ä½¿ç”¨æœ¬åœ°æˆ–æ•°æ® URI
- âœ… å›¾ç‰‡å…è®¸ HTTPS/HTTPï¼ˆç”¨äº faviconï¼‰ï¼Œç¬¦åˆé¢„æœŸ

### 3. æ„å»ºå’Œæ‰“åŒ… âœ…

#### 3.1 æ„å»ºé…ç½®
- âœ… `vite.config.ts` åªæ„å»ºæ‰©å±•ç›¸å…³æ–‡ä»¶
- âœ… `landing-page` ä¸åœ¨æ„å»ºè¾“å…¥ä¸­
- âœ… ä½¿ç”¨ `@crxjs/vite-plugin` æ­£ç¡®å¤„ç† Manifest V3

#### 3.2 æ‰“åŒ…è„šæœ¬
- âœ… `package-extension.js` åªæ‰“åŒ… `dist` ç›®å½•
- âœ… ä¸ä¼šåŒ…å« `landing-page` ç›®å½•

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. landing-page ç›®å½•
è™½ç„¶ `landing-page` ç›®å½•ä¸­æœ‰ Google Fonts å¼•ç”¨ï¼Œä½†ï¼š
- âœ… ä¸ä¼šè¢«åŒ…å«åœ¨æ‰©å±•åŒ…ä¸­
- âœ… ä¸å½±å“ Chrome Web Store å®¡æ ¸
- â„¹ï¸ å¦‚éœ€éƒ¨ç½²ç‹¬ç«‹ç½‘ç«™ï¼Œå¯ä»¥ä¿ç•™ï¼ˆä¸æ‰©å±•æ— å…³ï¼‰

### 2. CSP ä¸­çš„ `unsafe-inline` æ ·å¼
- âš ï¸ å…è®¸å†…è”æ ·å¼æ˜¯å¿…è¦çš„ï¼ˆReact å’Œ Tailwind CSS éœ€è¦ï¼‰
- âœ… Chrome Web Store å…è®¸æ ·å¼ä½¿ç”¨ `unsafe-inline`
- âœ… ä¸ä¼šå½±å“å®‰å…¨æ€§ï¼ˆåªå½±å“æ ·å¼ï¼Œä¸å½±å“è„šæœ¬ï¼‰

---

## ğŸ“‹ å»ºè®®çš„æœ€ä½³å®è·µ

### 1. æŒç»­ç›‘æ§
- âœ… å®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„è¿œç¨‹èµ„æºå¼•ç”¨
- âœ… åœ¨ä»£ç å®¡æŸ¥æ—¶æ³¨æ„åŠ¨æ€è„šæœ¬åŠ è½½
- âœ… ç›‘æ§ä¾èµ–åº“çš„å®‰å…¨æ›´æ–°

### 2. ä»£ç è´¨é‡
- âœ… ä½¿ç”¨ TypeScript æä¾›ç±»å‹å®‰å…¨
- âœ… ä½¿ç”¨ ESLint è¿›è¡Œä»£ç æ£€æŸ¥
- âœ… é¿å…ä½¿ç”¨ `eval()` å’Œ `Function()`

### 3. æƒé™æœ€å°åŒ–
- âœ… åªè¯·æ±‚å¿…è¦çš„æƒé™
- âœ… å®šæœŸå®¡æŸ¥æƒé™ä½¿ç”¨æƒ…å†µ
- âœ… æ–‡æ¡£åŒ–æ¯ä¸ªæƒé™çš„ä½¿ç”¨ç›®çš„

---

## âœ… æ€»ç»“

### åˆè§„æ€§çŠ¶æ€
- âœ… **Manifest V3 åˆè§„**: å®Œå…¨ç¬¦åˆ
- âœ… **è¿œç¨‹ä»£ç **: æ— è¿è§„
- âœ… **CSP é…ç½®**: åˆç†ä¸”å®‰å…¨
- âœ… **æƒé™ä½¿ç”¨**: æœ€å°åŒ–ä¸”åˆç†

### ç»“è®º
**æ‰©å±•å®Œå…¨ç¬¦åˆ Chrome Web Store çš„å®‰å…¨æ ‡å‡†å’Œè¦æ±‚ã€‚**

æ‰€æœ‰è¿œç¨‹ä»£ç å¼•ç”¨å·²ç§»é™¤ï¼ŒCSP é…ç½®åˆç†ï¼Œæƒé™ä½¿ç”¨æ°å½“ã€‚å¯ä»¥å®‰å…¨æäº¤åˆ° Chrome Web Storeã€‚

---

## ğŸ“ ä¿®å¤è®°å½•

### 2024å¹´ä¿®å¤
1. âœ… ç§»é™¤ `landing-page/script.js` ä¸­çš„ lazysizes è¿œç¨‹ä»£ç å¼•ç”¨
   - ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ lazy loading æ›¿ä»£
   - ç¬¦åˆ Manifest V3 è¦æ±‚

---

**å®¡æ ¸å®Œæˆæ—¶é—´**: 2024å¹´
**å®¡æ ¸çŠ¶æ€**: âœ… é€šè¿‡


# OneTab Plus 操作反馈标准和规范

## 概述

本文档定义了 OneTab Plus 项目中用户操作反馈的统一标准和规范，确保用户体验的一致性和可预测性。

## 反馈类型

### 1. Toast 通知

Toast 通知用于向用户提供操作结果的即时反馈。

#### 使用场景
- 操作成功确认
- 错误信息提示
- 警告信息
- 加载状态提示
- 信息性通知

#### 类型定义
```typescript
type ToastType = 'success' | 'error' | 'info' | 'warning' | 'loading';
```

#### 使用规范

**成功提示 (success)**
- 用于确认操作已成功完成
- 默认显示时间：3秒
- 颜色：绿色系
- 示例：`toast.success('数据同步成功')`

**错误提示 (error)**
- 用于显示操作失败信息
- 默认显示时间：5秒
- 颜色：红色系
- 应提供具体的错误原因和可能的解决方案
- 示例：`toast.error('网络连接失败，请检查网络设置')`

**信息提示 (info)**
- 用于显示一般性信息
- 默认显示时间：3秒
- 颜色：蓝色系
- 示例：`toast.info('数据已保存到本地')`

**警告提示 (warning)**
- 用于显示需要用户注意的信息
- 默认显示时间：5秒
- 颜色：黄色系
- 示例：`toast.warning('检测到数据冲突，需要手动解决')`

**加载提示 (loading)**
- 用于显示正在进行的操作
- 不自动关闭（duration: 0）
- 颜色：灰色系
- 必须手动关闭
- 示例：`toast.loading('正在同步数据...', { id: 'sync-progress' })`

### 2. 按钮状态

#### Loading 状态
- 使用 `LoadingButton` 组件
- 显示加载动画和加载文本
- 禁用按钮交互
- 示例：
```tsx
<LoadingButton
  loading={isLoading}
  loadingText="正在处理..."
  onClick={handleClick}
>
  提交
</LoadingButton>
```

#### 禁用状态
- 当操作不可用时禁用按钮
- 提供清晰的视觉反馈
- 可选择性地显示禁用原因

### 3. 表单验证反馈

#### 实时验证
- 在用户输入时提供即时反馈
- 使用内联错误消息
- 颜色：红色系

#### 提交验证
- 在表单提交时进行最终验证
- 聚焦到第一个错误字段
- 显示具体的错误信息

## 反馈时机

### 立即反馈
- 用户界面交互（点击、悬停等）
- 表单输入验证
- 按钮状态变化

### 延迟反馈
- 网络请求结果
- 文件操作结果
- 数据同步结果

### 持续反馈
- 长时间运行的操作
- 进度指示器
- 加载状态

## 错误处理规范

### 错误分类

**用户错误**
- 输入格式错误
- 必填字段缺失
- 权限不足

**系统错误**
- 网络连接问题
- 服务器错误
- 数据冲突

**业务错误**
- 操作不被允许
- 数据验证失败
- 状态冲突

### 错误消息规范

**结构**
```
[错误类型] 具体错误描述 [可选的解决建议]
```

**示例**
- ✅ "网络连接失败，请检查网络设置后重试"
- ✅ "邮箱格式不正确，请输入有效的邮箱地址"
- ❌ "错误"
- ❌ "操作失败"

### 错误恢复

**提供操作建议**
- 重试按钮
- 刷新页面
- 联系支持

**自动恢复**
- 网络重连后自动重试
- 临时错误的自动恢复
- 数据自动保存

## 成功反馈规范

### 即时确认
- 操作完成后立即显示成功消息
- 使用积极的语言
- 提供下一步操作建议

### 视觉反馈
- 使用绿色系颜色
- 显示成功图标
- 适当的动画效果

## 加载状态规范

### 短时间操作（< 1秒）
- 不显示加载状态
- 直接显示结果

### 中等时间操作（1-3秒）
- 显示按钮加载状态
- 禁用相关交互

### 长时间操作（> 3秒）
- 显示全局加载提示
- 提供进度指示（如果可能）
- 允许用户取消操作

## 实现指南

### 使用 useAsyncOperation Hook

```typescript
const operation = useAsyncOperation({
  loadingMessage: '正在处理...',
  successMessage: '操作成功',
  errorMessage: '操作失败',
});

const handleClick = async () => {
  await operation.execute(async () => {
    // 执行异步操作
    return await someAsyncFunction();
  });
};
```

### 使用 Toast API

```typescript
// 基础用法
toast.success('操作成功');
toast.error('操作失败');
toast.info('信息提示');
toast.warning('警告信息');

// 高级用法
toast.error('网络连接失败', {
  duration: 5000,
  action: {
    label: '重试',
    onClick: () => handleRetry(),
  },
});

// 加载状态
const loadingId = 'operation-loading';
toast.loading('正在处理...', { id: loadingId });
// 操作完成后
toast.dismiss(loadingId);
toast.success('操作完成');
```

## 可访问性考虑

### 屏幕阅读器支持
- 使用适当的 ARIA 标签
- 提供文本替代方案
- 确保焦点管理

### 键盘导航
- 支持键盘操作
- 提供快捷键
- 合理的 Tab 顺序

### 颜色对比
- 确保足够的颜色对比度
- 不仅依赖颜色传达信息
- 支持高对比度模式

## 测试要求

### 功能测试
- 验证所有反馈类型正常工作
- 测试错误处理流程
- 验证加载状态显示

### 用户体验测试
- 确保反馈及时准确
- 验证用户理解反馈内容
- 测试错误恢复流程

### 可访问性测试
- 屏幕阅读器兼容性
- 键盘导航测试
- 颜色对比度检查

## 维护和更新

### 定期审查
- 收集用户反馈
- 分析使用数据
- 更新规范文档

### 一致性检查
- 定期审查实现
- 确保规范遵循
- 修复不一致问题

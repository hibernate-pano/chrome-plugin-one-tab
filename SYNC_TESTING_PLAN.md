# OneTabPlus 同步架构重构测试计划

## 📋 测试概览

本文档描述了 OneTabPlus 数据同步架构重构后的测试计划，确保新的 pull-first 同步机制正常工作。

## 🎯 测试目标

1. **验证 Pull-First 同步策略**：确保每次用户操作前都先拉取云端最新数据
2. **验证定时同步机制**：确保每 10 秒执行一次的定时同步正常工作
3. **验证手动同步功能**：确保手动同步按钮功能正常
4. **验证数据一致性**：确保多设备间数据保持一致
5. **验证标签组排序**：确保标签组始终按时间倒序排列
6. **验证拖拽功能**：确保标签拖拽正常，标签组拖拽已禁用

## 🧪 测试用例

### 1. Pull-First 同步策略测试

#### 测试用例 1.1：保存新标签组
**步骤**：
1. 在设备 A 上保存一个新标签组
2. 观察控制台日志，确认执行了 pull-first 流程
3. 在设备 B 上检查是否收到新标签组

**预期结果**：
- 控制台显示 "开始用户操作同步 (pull-first)"
- 新标签组出现在设备 B 上
- 标签组按时间倒序排列

#### 测试用例 1.2：删除标签组
**步骤**：
1. 在设备 A 上删除一个标签组
2. 观察控制台日志
3. 在设备 B 上检查标签组是否被删除

**预期结果**：
- 执行 pull-first 流程
- 标签组在设备 B 上被删除

#### 测试用例 1.3：重命名标签组
**步骤**：
1. 在设备 A 上重命名一个标签组
2. 观察同步过程
3. 在设备 B 上检查名称是否更新

**预期结果**：
- 执行 pull-first 流程
- 标签组名称在设备 B 上更新

### 2. 定时同步机制测试

#### 测试用例 2.1：定时同步间隔
**步骤**：
1. 登录用户账户
2. 启用自动同步
3. 观察控制台日志，记录同步间隔

**预期结果**：
- 每 10 秒执行一次定时同步
- 控制台显示 "开始定期同步 (pull-only)"

#### 测试用例 2.2：登录状态变化
**步骤**：
1. 用户登出
2. 观察定时同步是否停止
3. 用户重新登录
4. 观察定时同步是否重新启动

**预期结果**：
- 登出时定时同步停止
- 登录时定时同步重新启动

### 3. 手动同步功能测试

#### 测试用例 3.1：手动同步按钮
**步骤**：
1. 登录用户账户
2. 查看同步按钮区域
3. 点击手动同步按钮

**预期结果**：
- 显示紫色的"同步"按钮
- 点击后显示加载状态
- 执行完整的 pull-first 同步流程

#### 测试用例 3.2：同步状态反馈
**步骤**：
1. 点击手动同步按钮
2. 观察按钮状态变化
3. 观察成功/失败提示

**预期结果**：
- 按钮显示"同步中..."状态
- 完成后显示成功提示
- 失败时显示错误信息

### 4. 数据一致性测试

#### 测试用例 4.1：并发操作
**步骤**：
1. 在设备 A 和设备 B 上同时进行操作
2. 等待同步完成
3. 检查两设备数据是否一致

**预期结果**：
- 数据最终保持一致
- 没有数据丢失或重复

#### 测试用例 4.2：网络中断恢复
**步骤**：
1. 断开网络连接
2. 进行本地操作
3. 恢复网络连接
4. 观察同步恢复过程

**预期结果**：
- 网络恢复后自动同步
- 本地操作数据正确上传

### 5. 标签组排序测试

#### 测试用例 5.1：新建标签组排序
**步骤**：
1. 创建多个标签组
2. 检查标签组列表顺序

**预期结果**：
- 最新创建的标签组在最前面
- 所有标签组按创建时间倒序排列

#### 测试用例 5.2：同步后排序
**步骤**：
1. 在设备 A 创建标签组
2. 在设备 B 检查排序
3. 执行手动同步
4. 再次检查排序

**预期结果**：
- 同步前后排序保持一致
- 时间倒序排列不变

### 6. 拖拽功能测试

#### 测试用例 6.1：标签拖拽
**步骤**：
1. 在标签组内拖拽标签
2. 跨标签组拖拽标签
3. 观察同步行为

**预期结果**：
- 标签拖拽正常工作
- 拖拽后触发 pull-first 同步
- 空标签组自动删除

#### 测试用例 6.2：标签组拖拽禁用
**步骤**：
1. 尝试拖拽整个标签组
2. 检查拖拽手柄是否移除

**预期结果**：
- 无法拖拽标签组
- 标签组头部没有拖拽手柄
- 不显示拖拽光标

## 🔍 性能测试

### 测试用例 P.1：同步性能
**步骤**：
1. 创建大量标签组（100+）
2. 测试同步时间
3. 观察内存使用情况

**预期结果**：
- 同步时间在可接受范围内
- 内存使用稳定

### 测试用例 P.2：定时同步影响
**步骤**：
1. 长时间运行应用
2. 观察定时同步对性能的影响

**预期结果**：
- 定时同步不影响用户操作
- CPU 使用率保持正常

## 🐛 错误处理测试

### 测试用例 E.1：网络错误
**步骤**：
1. 模拟网络错误
2. 尝试同步操作
3. 观察错误处理

**预期结果**：
- 显示清晰的错误信息
- 不影响本地操作
- 网络恢复后自动重试

### 测试用例 E.2：认证失败
**步骤**：
1. 模拟认证过期
2. 尝试同步操作

**预期结果**：
- 提示重新登录
- 本地数据不丢失

## ✅ 验收标准

### 功能性标准
- [ ] 所有用户操作都执行 pull-first 同步
- [ ] 定时同步每 10 秒执行一次
- [ ] 手动同步按钮正常工作
- [ ] 标签组始终按时间倒序排列
- [ ] 标签拖拽正常，标签组拖拽已禁用
- [ ] 多设备数据保持一致

### 性能标准
- [ ] 同步操作响应时间 < 3 秒
- [ ] 定时同步不影响用户体验
- [ ] 内存使用稳定

### 用户体验标准
- [ ] 同步状态反馈清晰
- [ ] 错误信息友好易懂
- [ ] 操作流程顺畅

## 📝 测试记录

### 测试环境
- **浏览器**：Chrome 最新版本
- **操作系统**：macOS/Windows/Linux
- **网络环境**：正常网络/慢速网络/间歇性网络

### 测试结果记录
每个测试用例的结果将记录在此处，包括：
- 测试日期
- 测试结果（通过/失败）
- 发现的问题
- 修复建议

## 🚀 部署前检查清单

- [ ] 所有测试用例通过
- [ ] 性能指标达标
- [ ] 错误处理完善
- [ ] 用户体验良好
- [ ] 代码审查完成
- [ ] 文档更新完成
